<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="import_portal" name="Import Portal" inherit_id="portal.portal_my_home" customize_show="True">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="before">
            <t t-set="portal_vendor_category_enable" t-value="True"/>   
        </xpath>
        <div id="portal_vendor_category" position="inside">
            <t t-call="portal.portal_docs_entry">
                <t t-set="icon" t-value="'data_fetcher_shopify/static/src/img/bag.svg'"/>
                <t t-set="title">Import Portal</t>
                <t t-set="url" t-value="'/my/import'"/>
                <t t-set="text">Import data from Shopify/Salesforce</t>
                <t t-set="placeholder_count" t-value="'invoice_count'"/>
            </t>
        </div>
    </template>
<template id="portal_credentials_form_base" name="Data Fetcher Base Form">
    <t t-call="portal.portal_layout">
        <div class="container mt-5">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">üîÑ Odoo Import Tool</h4>
                </div>
                <div class="card-body">
                    <form id="dynamic-credentials-form" method="post" action="/my/api/data_transfer">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                        <!-- System Selector -->
                        <div class="mb-4">
                            <label class="form-label">Select System</label>
                            <t t-foreach="systems" t-as="sys">
                                <div>
                                    <input type="radio" t-att-id="sys" name="system" t-att-value="sys" t-att-checked="sys_first"/>
                                    <label t-att-for="sys" t-esc="sys.capitalize()"/>
                                </div>
                            </t>
                        </div>

                        <!-- Placeholder for service-specific credentials -->
                        <div id="external-credentials-placeholder">
                            <t t-call="data_fetcher_base.credentials_placeholder"/>
                        </div>

                        <!-- Odoo Credentials -->
                        <h5 class="mt-4 mb-3">‚öôÔ∏è Odoo Credentials</h5>
                        <div class="mb-3">
                            <label class="form-label">Odoo URL</label>
                            <input type="text" class="form-control" name="odoo_url" placeholder="https://odoo.yourdomain.com" required="1"/>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Odoo Database</label>
                            <input type="text" class="form-control" name="odoo_db" placeholder="demo_db" required="1"/>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Odoo Username</label>
                            <input type="text" class="form-control" name="odoo_username" placeholder="admin" required="1"/>
                        </div>
                        <div class="mb-4">
                            <label class="form-label">Odoo API Key</label>
                            <input type="password" class="form-control" name="odoo_api_key" required="1"/>
                        </div>

                        <div class="text-end">
                            <button type="submit" class="btn btn-primary">üöÄ Start Sync</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Common JS -->
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const radios = document.querySelectorAll('input[name="system"]');
            const form = document.getElementById('dynamic-credentials-form');

            function updateFormAndFields() {
                const selected = document.querySelector('input[name="system"]:checked').value;
                
                // Show/hide credential blocks
                document.querySelectorAll('[data-cred-block]').forEach(el => {
                    el.style.display = el.getAttribute('data-cred-block') === selected ? 'block' : 'none';
                    el.querySelectorAll('input').forEach(input => {
                        input.toggleAttribute('required', el.getAttribute('data-cred-block') === selected);
                    });
                });
            }

            form.addEventListener('submit', function(e) {
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.disabled = true;
                submitBtn.style.backgroundColor = '#ccc';
                submitBtn.style.borderColor = '#ccc';
                submitBtn.style.color = '#666';
                submitBtn.style.cursor = 'not-allowed';
                submitBtn.innerHTML = '‚è≥ Syncing...';
            });

            radios.forEach(radio => radio.addEventListener('change', updateFormAndFields));
            updateFormAndFields();
        });
        </script>
    </t>
</template>

<template id="credentials_placeholder" name="External Credentials Placeholder">
    <!-- Empty base slot to be overridden -->
</template>


    <template id="portal_import_data_result" name="Import Data Result">
    <t t-call="web.html_container">
        <div class="oe_structure container mt-5">
            <div class="card rounded-lg text-center py-5">
                <div class="card-body">
                    <t t-if="error">
                        <!-- Error Cross -->
                        <div class="text-danger mb-4" style="font-size: 8rem;">
                            <i class="fa fa-times-circle"></i>
                        </div>
                        <h3 class="text-danger mb-4">Import Failed</h3>
                        <p class="text-muted" t-esc="error"/>
                    </t>
                    <t t-if="results">
                        <!-- Success Tick -->
                        <div class="text-success mb-4" style="font-size: 8rem;">
                            <i class="fa fa-check-circle"></i>
                        </div>
                        <h3 class="text-success mb-4">Import Successful</h3>
                        <p class="text-muted" t-esc="results"/>
                    </t>
                    
                    <div class="mt-4">
                        <a href="/my" class="btn btn-primary">Return to My Account</a>
                    </div>
                </div>
            </div>
        </div>
    </t>
</template>
</odoo>